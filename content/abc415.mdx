---
title: ABC415
date: 2025-08-20
tags: 
    - atcoder
---

## 問題
瓶入りコーラが$N$本ある。以下のいずれかの行動を選んで取ることを好きな回数繰り返すことができる。

- 持っている瓶入りコーラ$1$本を飲む。持っている瓶入りコーラの本数が$1$減り、空き瓶の本数が$1$増える。（行動前に$1$本も瓶入りコーラを持っていない場合、この行動は取れない。）

- $1$以上$M$以下の整数$i$を選ぶ。コーラショップに$A_i$本の空き瓶を渡し、引き換えに$B_i$本の瓶入りコーラおよび記念のシール$1$枚をもらう。（行動前に持っている空き瓶の本数が$A_i$未満であるような$i$は選ぶことができない。選ぶことのできる$i$が存在しない場合、この行動は取れない。）

うまく行動を取ったとき、最大で何枚のシールを手に入れることができるか。 初めは空き瓶を$1$本も持っておらず、シールも$1$枚も持っていない。

## 制約
- $1\leq N\leq 10^{18}$
- $1\leq M\leq 2\times10^5$

## 考察
$N\geq A_i$であれば、ショップ$i$を選んで、シールを1枚獲得することができる。その代わり、空き瓶は$A_i - B_i$だけ減る。 シールをできるだけ多く獲得するには、空き瓶ができるだけ減らないようにする。ショップを$A_i-B_i$でソートして、小さい方から選ぶ。単純にシミュレートすると計算量が大きすぎるので、次のように工夫する: 

ショップを$A-B$の値が増加するように並び替える。初めのショップから順に、そのショップを連続で何回使えるか$(\equiv x)$計算で求める。

$$
x= \left\lfloor\frac{(現在所有している空き瓶の数)-A}{A - B}\right\rfloor + 1
$$

これを繰り返せば答えが得られる。
なおこの式を得るには次のように考える。まず、$N$から$D$を連続して可能な限り引き、引いた結果が$A$以上になるようにする。この条件を満たすような引ける回数の最大が、右辺の第一項であり、第二項はそこからあと1回だけ引けることを表している。

また、同じ$A-B$が複数あった場合、どのショップを選んでも構わない。
